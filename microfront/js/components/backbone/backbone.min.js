(function(){var t=this;var e=t.Backbone;var i=[];var s=i.push;var r=i.slice;var n=i.splice;var a;if(typeof exports!=="undefined"){a=exports}else{a=t.Backbone={}}a.VERSION="0.9.10";var h=t._;if(!h&&typeof require!=="undefined")h=require("underscore");a.$=t.jQuery||t.Zepto||t.ender;a.noConflict=function(){t.Backbone=e;return this};a.emulateHTTP=false;a.emulateJSON=false;var o=/\s+/;var u=function(t,e,i,s){if(!i)return true;if(typeof i==="object"){for(var r in i){t[e].apply(t,[r,i[r]].concat(s))}}else if(o.test(i)){var n=i.split(o);for(var a=0,h=n.length;a<h;a++){t[e].apply(t,[n[a]].concat(s))}}else{return true}};var l=function(t,e){var i,s=-1,r=t.length;switch(e.length){case 0:while(++s<r)(i=t[s]).callback.call(i.ctx);return;case 1:while(++s<r)(i=t[s]).callback.call(i.ctx,e[0]);return;case 2:while(++s<r)(i=t[s]).callback.call(i.ctx,e[0],e[1]);return;case 3:while(++s<r)(i=t[s]).callback.call(i.ctx,e[0],e[1],e[2]);return;default:while(++s<r)(i=t[s]).callback.apply(i.ctx,e)}};var c=a.Events={on:function(t,e,i){if(!(u(this,"on",t,[e,i])&&e))return this;this._events||(this._events={});var s=this._events[t]||(this._events[t]=[]);s.push({callback:e,context:i,ctx:i||this});return this},once:function(t,e,i){if(!(u(this,"once",t,[e,i])&&e))return this;var s=this;var r=h.once(function(){s.off(t,r);e.apply(this,arguments)});r._callback=e;this.on(t,r,i);return this},off:function(t,e,i){var s,r,n,a,o,l,c,f;if(!this._events||!u(this,"off",t,[e,i]))return this;if(!t&&!e&&!i){this._events={};return this}a=t?[t]:h.keys(this._events);for(o=0,l=a.length;o<l;o++){t=a[o];if(s=this._events[t]){n=[];if(e||i){for(c=0,f=s.length;c<f;c++){r=s[c];if(e&&e!==r.callback&&e!==r.callback._callback||i&&i!==r.context){n.push(r)}}}this._events[t]=n}}return this},trigger:function(t){if(!this._events)return this;var e=r.call(arguments,1);if(!u(this,"trigger",t,e))return this;var i=this._events[t];var s=this._events.all;if(i)l(i,e);if(s)l(s,arguments);return this},listenTo:function(t,e,i){var s=this._listeners||(this._listeners={});var r=t._listenerId||(t._listenerId=h.uniqueId("l"));s[r]=t;t.on(e,typeof e==="object"?this:i,this);return this},stopListening:function(t,e,i){var s=this._listeners;if(!s)return;if(t){t.off(e,typeof e==="object"?this:i,this);if(!e&&!i)delete s[t._listenerId]}else{if(typeof e==="object")i=this;for(var r in s){s[r].off(e,i,this)}this._listeners={}}return this}};c.bind=c.on;c.unbind=c.off;h.extend(a,c);var f=a.Model=function(t,e){var i;var s=t||{};this.cid=h.uniqueId("c");this.attributes={};if(e&&e.collection)this.collection=e.collection;if(e&&e.parse)s=this.parse(s,e)||{};if(i=h.result(this,"defaults")){s=h.defaults({},s,i)}this.set(s,e);this.changed={};this.initialize.apply(this,arguments)};h.extend(f.prototype,c,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return h.escape(this.get(t))},has:function(t){return this.get(t)!=null},set:function(t,e,i){var s,r,n,a,o,u,l,c;if(t==null)return this;if(typeof t==="object"){r=t;i=e}else{(r={})[t]=e}i||(i={});if(!this._validate(r,i))return false;n=i.unset;o=i.silent;a=[];u=this._changing;this._changing=true;if(!u){this._previousAttributes=h.clone(this.attributes);this.changed={}}c=this.attributes,l=this._previousAttributes;if(this.idAttribute in r)this.id=r[this.idAttribute];for(s in r){e=r[s];if(!h.isEqual(c[s],e))a.push(s);if(!h.isEqual(l[s],e)){this.changed[s]=e}else{delete this.changed[s]}n?delete c[s]:c[s]=e}if(!o){if(a.length)this._pending=true;for(var f=0,d=a.length;f<d;f++){this.trigger("change:"+a[f],this,c[a[f]],i)}}if(u)return this;if(!o){while(this._pending){this._pending=false;this.trigger("change",this,i)}}this._pending=false;this._changing=false;return this},unset:function(t,e){return this.set(t,void 0,h.extend({},e,{unset:true}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,h.extend({},t,{unset:true}))},hasChanged:function(t){if(t==null)return!h.isEmpty(this.changed);return h.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?h.clone(this.changed):false;var e,i=false;var s=this._changing?this._previousAttributes:this.attributes;for(var r in t){if(h.isEqual(s[r],e=t[r]))continue;(i||(i={}))[r]=e}return i},previous:function(t){if(t==null||!this._previousAttributes)return null;return this._previousAttributes[t]},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=t.success;t.success=function(t,i,s){if(!t.set(t.parse(i,s),s))return false;if(e)e(t,i,s)};return this.sync("read",this,t)},save:function(t,e,i){var s,r,n,a,o=this.attributes;if(t==null||typeof t==="object"){s=t;i=e}else{(s={})[t]=e}if(s&&(!i||!i.wait)&&!this.set(s,i))return false;i=h.extend({validate:true},i);if(!this._validate(s,i))return false;if(s&&i.wait){this.attributes=h.extend({},o,s)}if(i.parse===void 0)i.parse=true;r=i.success;i.success=function(t,e,i){t.attributes=o;var n=t.parse(e,i);if(i.wait)n=h.extend(s||{},n);if(h.isObject(n)&&!t.set(n,i)){return false}if(r)r(t,e,i)};n=this.isNew()?"create":i.patch?"patch":"update";if(n==="patch")i.attrs=s;a=this.sync(n,this,i);if(s&&i.wait)this.attributes=o;return a},destroy:function(t){t=t?h.clone(t):{};var e=this;var i=t.success;var s=function(){e.trigger("destroy",e,e.collection,t)};t.success=function(t,e,r){if(r.wait||t.isNew())s();if(i)i(t,e,r)};if(this.isNew()){t.success(this,null,t);return false}var r=this.sync("delete",this,t);if(!t.wait)s();return r},url:function(){var t=h.result(this,"urlRoot")||h.result(this.collection,"url")||N();if(this.isNew())return t;return t+(t.charAt(t.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(t){return!this.validate||!this.validate(this.attributes,t)},_validate:function(t,e){if(!e.validate||!this.validate)return true;t=h.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;if(!i)return true;this.trigger("invalid",this,i,e||{});return false}});var d=a.Collection=function(t,e){e||(e={});if(e.model)this.model=e.model;if(e.comparator!==void 0)this.comparator=e.comparator;this.models=[];this._reset();this.initialize.apply(this,arguments);if(t)this.reset(t,h.extend({silent:true},e))};h.extend(d.prototype,c,{model:f,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return a.sync.apply(this,arguments)},add:function(t,e){t=h.isArray(t)?t.slice():[t];e||(e={});var i,r,a,o,u,l,c,f,d,p;c=[];f=e.at;d=this.comparator&&f==null&&e.sort!=false;p=h.isString(this.comparator)?this.comparator:null;for(i=0,r=t.length;i<r;i++){if(!(a=this._prepareModel(o=t[i],e))){this.trigger("invalid",this,o,e);continue}if(u=this.get(a)){if(e.merge){u.set(o===a?a.attributes:o,e);if(d&&!l&&u.hasChanged(p))l=true}continue}c.push(a);a.on("all",this._onModelEvent,this);this._byId[a.cid]=a;if(a.id!=null)this._byId[a.id]=a}if(c.length){if(d)l=true;this.length+=c.length;if(f!=null){n.apply(this.models,[f,0].concat(c))}else{s.apply(this.models,c)}}if(l)this.sort({silent:true});if(e.silent)return this;for(i=0,r=c.length;i<r;i++){(a=c[i]).trigger("add",a,this,e)}if(l)this.trigger("sort",this,e);return this},remove:function(t,e){t=h.isArray(t)?t.slice():[t];e||(e={});var i,s,r,n;for(i=0,s=t.length;i<s;i++){n=this.get(t[i]);if(!n)continue;delete this._byId[n.id];delete this._byId[n.cid];r=this.indexOf(n);this.models.splice(r,1);this.length--;if(!e.silent){e.index=r;n.trigger("remove",n,this,e)}this._removeReference(n)}return this},push:function(t,e){t=this._prepareModel(t,e);this.add(t,h.extend({at:this.length},e));return t},pop:function(t){var e=this.at(this.length-1);this.remove(e,t);return e},unshift:function(t,e){t=this._prepareModel(t,e);this.add(t,h.extend({at:0},e));return t},shift:function(t){var e=this.at(0);this.remove(e,t);return e},slice:function(t,e){return this.models.slice(t,e)},get:function(t){if(t==null)return void 0;this._idAttr||(this._idAttr=this.model.prototype.idAttribute);return this._byId[t.id||t.cid||t[this._idAttr]||t]},at:function(t){return this.models[t]},where:function(t){if(h.isEmpty(t))return[];return this.filter(function(e){for(var i in t){if(t[i]!==e.get(i))return false}return true})},sort:function(t){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}t||(t={});if(h.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(h.bind(this.comparator,this))}if(!t.silent)this.trigger("sort",this,t);return this},pluck:function(t){return h.invoke(this.models,"get",t)},update:function(t,e){e=h.extend({add:true,merge:true,remove:true},e);if(e.parse)t=this.parse(t,e);var i,s,r,n;var a=[],o=[],u={};if(!h.isArray(t))t=t?[t]:[];if(e.add&&!e.remove)return this.add(t,e);for(s=0,r=t.length;s<r;s++){i=t[s];n=this.get(i);if(e.remove&&n)u[n.cid]=true;if(e.add&&!n||e.merge&&n){a.push(i)}}if(e.remove){for(s=0,r=this.models.length;s<r;s++){i=this.models[s];if(!u[i.cid])o.push(i)}}if(o.length)this.remove(o,e);if(a.length)this.add(a,e);return this},reset:function(t,e){e||(e={});if(e.parse)t=this.parse(t,e);for(var i=0,s=this.models.length;i<s;i++){this._removeReference(this.models[i])}e.previousModels=this.models.slice();this._reset();if(t)this.add(t,h.extend({silent:true},e));if(!e.silent)this.trigger("reset",this,e);return this},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=t.success;t.success=function(t,i,s){var r=s.update?"update":"reset";t[r](i,s);if(e)e(t,i,s)};return this.sync("read",this,t)},create:function(t,e){e=e?h.clone(e):{};if(!(t=this._prepareModel(t,e)))return false;if(!e.wait)this.add(t,e);var i=this;var s=e.success;e.success=function(t,e,r){if(r.wait)i.add(t,r);if(s)s(t,e,r)};t.save(null,e);return t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models.length=0;this._byId={}},_prepareModel:function(t,e){if(t instanceof f){if(!t.collection)t.collection=this;return t}e||(e={});e.collection=this;var i=new this.model(t,e);if(!i._validate(t,e))return false;return i},_removeReference:function(t){if(this===t.collection)delete t.collection;t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,s){if((t==="add"||t==="remove")&&i!==this)return;if(t==="destroy")this.remove(e,s);if(e&&t==="change:"+e.idAttribute){delete this._byId[e.previous(e.idAttribute)];if(e.id!=null)this._byId[e.id]=e}this.trigger.apply(this,arguments)},sortedIndex:function(t,e,i){e||(e=this.comparator);var s=h.isFunction(e)?e:function(t){return t.get(e)};return h.sortedIndex(this.models,t,s,i)}});var p=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(p,function(t){d.prototype[t]=function(){var e=r.call(arguments);e.unshift(this.models);return h[t].apply(h,e)}});var g=["groupBy","countBy","sortBy"];h.each(g,function(t){d.prototype[t]=function(e,i){var s=h.isFunction(e)?e:function(t){return t.get(e)};return h[t](this.models,s,i)}});var v=a.Router=function(t){t||(t={});if(t.routes)this.routes=t.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var m=/\((.*?)\)/g;var y=/(\(\?)?:\w+/g;var _=/\*\w+/g;var b=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(v.prototype,c,{initialize:function(){},route:function(t,e,i){if(!h.isRegExp(t))t=this._routeToRegExp(t);if(!i)i=this[e];a.history.route(t,h.bind(function(s){var r=this._extractParameters(t,s);i&&i.apply(this,r);this.trigger.apply(this,["route:"+e].concat(r));this.trigger("route",e,r);a.history.trigger("route",this,e,r)},this));return this},navigate:function(t,e){a.history.navigate(t,e);return this},_bindRoutes:function(){if(!this.routes)return;var t,e=h.keys(this.routes);while((t=e.pop())!=null){this.route(t,this.routes[t])}},_routeToRegExp:function(t){t=t.replace(b,"\\$&").replace(m,"(?:$1)?").replace(y,function(t,e){return e?t:"([^/]+)"}).replace(_,"(.*?)");return new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var w=a.History=function(){this.handlers=[];h.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var x=/^[#\/]|\s+$/g;var E=/^\/+|\/+$/g;var S=/msie [\w.]+/;var k=/\/$/;w.started=false;h.extend(w.prototype,c,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(t==null){if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(k,"");if(!t.indexOf(i))t=t.substr(i.length)}else{t=this.getHash()}}return t.replace(x,"")},start:function(t){if(w.started)throw new Error("Backbone.history has already been started");w.started=true;this.options=h.extend({},{root:"/"},this.options,t);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment();var i=document.documentMode;var s=S.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(E,"/");if(s&&this._wantsHashChange){this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){a.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!s){a.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=e;var r=this.location;var n=r.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!n){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&n&&r.hash){this.fragment=this.getHash().replace(x,"");this.history.replaceState({},document.title,this.root+this.fragment+r.search)}if(!this.options.silent)return this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);w.started=false},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe){e=this.getFragment(this.getHash(this.iframe))}if(e===this.fragment)return false;if(this.iframe)this.navigate(e);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(t){var e=this.fragment=this.getFragment(t);var i=h.any(this.handlers,function(t){if(t.route.test(e)){t.callback(e);return true}});return i},navigate:function(t,e){if(!w.started)return false;if(!e||e===true)e={trigger:e};t=this.getFragment(t||"");if(this.fragment===t)return;this.fragment=t;var i=this.root+t;if(this._hasPushState){this.history[e.replace?"replaceState":"pushState"]({},document.title,i)}else if(this._wantsHashChange){this._updateHash(this.location,t,e.replace);if(this.iframe&&t!==this.getFragment(this.getHash(this.iframe))){if(!e.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,t,e.replace)}}else{return this.location.assign(i)}if(e.trigger)this.loadUrl(t)},_updateHash:function(t,e,i){if(i){var s=t.href.replace(/(javascript:|#).*$/,"");t.replace(s+"#"+e)}else{t.hash="#"+e}}});a.history=new w;var $=a.View=function(t){this.cid=h.uniqueId("view");this._configure(t||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var A=/^(\S+)\s*(.*)$/;var T=["model","collection","el","id","attributes","className","tagName","events"];h.extend($.prototype,c,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(t,e){if(this.$el)this.undelegateEvents();this.$el=t instanceof a.$?t:a.$(t);this.el=this.$el[0];if(e!==false)this.delegateEvents();return this},delegateEvents:function(t){if(!(t||(t=h.result(this,"events"))))return;this.undelegateEvents();for(var e in t){var i=t[e];if(!h.isFunction(i))i=this[t[e]];if(!i)throw new Error('Method "'+t[e]+'" does not exist');var s=e.match(A);var r=s[1],n=s[2];i=h.bind(i,this);r+=".delegateEvents"+this.cid;if(n===""){this.$el.on(r,i)}else{this.$el.on(r,n,i)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(t){if(this.options)t=h.extend({},h.result(this,"options"),t);h.extend(this,h.pick(t,T));this.options=t},_ensureElement:function(){if(!this.el){var t=h.extend({},h.result(this,"attributes"));if(this.id)t.id=h.result(this,"id");if(this.className)t["class"]=h.result(this,"className");var e=a.$("<"+h.result(this,"tagName")+">").attr(t);this.setElement(e,false)}else{this.setElement(h.result(this,"el"),false)}}});var H={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.sync=function(t,e,i){var s=H[t];h.defaults(i||(i={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var r={type:s,dataType:"json"};if(!i.url){r.url=h.result(e,"url")||N()}if(i.data==null&&e&&(t==="create"||t==="update"||t==="patch")){r.contentType="application/json";r.data=JSON.stringify(i.attrs||e.toJSON(i))}if(i.emulateJSON){r.contentType="application/x-www-form-urlencoded";r.data=r.data?{model:r.data}:{}}if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){r.type="POST";if(i.emulateJSON)r.data._method=s;var n=i.beforeSend;i.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",s);if(n)return n.apply(this,arguments)}}if(r.type!=="GET"&&!i.emulateJSON){r.processData=false}var o=i.success;i.success=function(t){if(o)o(e,t,i);e.trigger("sync",e,t,i)};var u=i.error;i.error=function(t){if(u)u(e,t,i);e.trigger("error",e,t,i)};var l=i.xhr=a.ajax(h.extend(r,i));e.trigger("request",e,l,i);return l};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var I=function(t,e){var i=this;var s;if(t&&h.has(t,"constructor")){s=t.constructor}else{s=function(){return i.apply(this,arguments)}}h.extend(s,i,e);var r=function(){this.constructor=s};r.prototype=i.prototype;s.prototype=new r;if(t)h.extend(s.prototype,t);s.__super__=i.prototype;return s};f.extend=d.extend=v.extend=$.extend=w.extend=I;var N=function(){throw new Error('A "url" property or function must be specified')}}).call(this);